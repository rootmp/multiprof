package l2s.gameserver.network.l2.s2c;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import l2s.gameserver.data.xml.holder.ProductDataHolder;
import l2s.gameserver.model.Player;
import l2s.gameserver.templates.item.product.ProductItem;
import l2s.gameserver.templates.item.product.ProductItemComponent;
import l2s.gameserver.utils.ItemFunctions;

/**
 * @author Bonux
 **/
public class ReciveVipProductList extends L2GameServerPacket
{
	private final long _adena, _silverCoins, _goldCoins;
	private final List<ProductItem> _products = new ArrayList<ProductItem>();

	public ReciveVipProductList(Player player)
	{
		_adena = player.getAdena();
		_silverCoins = ItemFunctions.getItemCount(player, 29983);
		_goldCoins = ItemFunctions.getItemCount(player, 29984);
		_products.addAll(ProductDataHolder.getInstance().getProductsOnSale(player));
		Collections.sort(_products);
	}

	@Override
	protected void writeImpl()
	{
		// FE8501F4201000000000000000000000000000BF0B0000000000000175000000A28601000D000000000000000000060202014A71000001000000078701000B000900000000000000000007015171000001000000088701000D000C00000000000000000407014F730000010000006B8701000B0009000000000000000000070153710000010000006C8701000D000F000000000000000004070154710000010000006D8701000D000F0000000000000000040701DD130100010000006E8701000D00130000000000000000040701DE13010001000000FB8801000B000500000000000000000007016771000001000000FC8801000D000C00000000000000000407016871000001000000FD8801000B00090000000000000000000701DB13010001000000FE8801000D000D0000000000000000040701DC13010001000000C48901000B00190000000000000000000701DC71000001000000C58901000B000900000000000000000007016571000001000000C68901000B0019000000000000000000070166710000010000002C8A01000B000D0000000000000000000701DD710000010000002D8A01000B000D0000000000000000000701DE710000010000002E8A01000B000D0000000000000000000701DF710000010000002F8A01000B000D0000000000000000000701E071000001000000308A01000B000D0000000000000000000701E171000001000000318A01000B000D0000000000000000000701E271000001000000328A01000B000D0000000000000000000701E371000001000000338A01000B004F0000000000000000000701D732000001000000348A01000B00090000000000000000000701D832000001000000358A01000B00090000000000000000000701414E0000010000008B8A01000E0086010000000000000000070146730000010000008C8A01000D000000000000000000000107016F73000001000000928A01000D000000000000000000000207013012010001000000938A01000D001D00000000000000000007014312010001000000948A01000D004500000000000000000007014412010001000000958A01000E00E00100000000000000000701D873000001000000B38A01000B00090000000000000000000701CD13010001000000B48A01000B00140000000000000000000701CE13010001000000B58A01000B00400000000000000000000701CF13010001000000B68A01000B00600000000000000000000701D013010001000000B78A01000B009C0000000000000000000701D113010001000000B88A01000B000E0000000000000000000701D213010001000000B98A01000B00160000000000000000000701D313010001000000BA8A01000B00620000000000000000000701D413010001000000BB8A01000B00A80000000000000000000701D513010001000000BC8A01000B00040100000000000000000701D613010001000000BD8A01000B000B00000000000000000007014760010001000000BE8A01000B000B00000000000000000007014860010001000000BF8A01000B000B00000000000000000007014960010001000000C08A01000B000B00000000000000000007014A60010001000000C18A01000B002700000000000000000007015F12010001000000C28A01000B002700000000000000000007016212010001000000C38A01000B002700000000000000000007016512010001000000C48A01000D002700000000000000000407016812010001000000C58A01000D002700000000000000000507016B12010001000000C68A01000B00030000000000000000000701D112010001000000C78A01000B00050000000000000000000701D212010001000000C88A01000D00080000000000000000040701D312010001000000C98A01000B00F30100000000000000060701FEC1000001000000CA8A01000D000F0000000000000000040701E913010001000000CB8A01000B000C0000000000000000000701EA13010001000000CC8A01000D004F0000000000000000040701DA13010001000000718E01000F0303000000C8000000000007017011010001000000728E01000F030100000000000000000007019F11010002000000738E01000F030000000064000000000007014807000064000000748E01000F030000000064000000000007014907000032000000758E01000F030000000096000000000007014A07000032000000768E01000F030000000096000000000007014B07000064000000778E01000F030000000064000000000007014C07000064000000788E01000F030000000064000000000007014D07000032000000798E01000F030000000064000000000007014E070000320000007A8E01000F030000000064000000000007014F070000320000007B8E01000F0300000000960000000000070150070000640000007C8E01000F0300000000640000000000070151070000140000007D8E01000F03000000002C01000000000701520700000A0000007E8E01000F03020000006400000000000701530700000A0000007F8E01000F03000000006400000000000701540700000A000000808E01000F030000000064000000000007015507000002000000818E01000F030000000064000000000007015607000014000000828E01000F03000000007800000000000701570700000A000000838E01000F0300000000C800000000000701580700000A000000848E01000F03000000009600000000000701590700000A000000858E01000F0300000000B4000000000007015A07000014000000868E01000F030500000000000000000007015B0700000A000000878E01000F030000000062000000000007015C0700001E000000888E01000F0300000000F0000000000007015D0700000A000000898E01000F030700000000000000000007015E070000050000008A8E01000F030000000095010000000007015F070000050000008B8E01000F03000000004A0100000000070160070000050000008C8E01000F03000000002C01000000000701610700000A0000008D8E01000F03000000008F0200000000070162070000050000008E8E01000F030A000000000000000000070163070000010000008F8E01000F030700000000000000000007016407000001000000908E01000F0300000000F6000000000007016507000001000000918E01000F03000000003A02000000000701660700000A000000928E01000F030000000018010000000007016707000028000000938E01000F03030000002C01000000000701C70F00000A000000948E01000F03010000000000000000000701C80F000001000000958E01000F030A0000009600000000000701C90F000005000000968E01000F03000000007800000000000701CA0F000001000000978E01000F03000000005802000000000701CB0F00000A000000988E01000F03000000005802000000000701CC0F00000A000000998E01000F031E0000005604000000000701CD0F0000010000009A8E01000F03070000002C01000000000701CE0F0000010000009B8E01000F03320000003408000000000701CF0F0000010000009C8E01000F030B000000B801000000000701D00F000001000000B78E01000E002B01000000000000060007024C13010002000000B88E01000E00C309000000000000060007034C1301001E000000CA8E01000E00630000000000000006000701DD14010001000000CB8E01000E00630000000000000006000701DE14010001000000CC8E01000E00630000000000000006000701DF14010001000000CD8E01000E00630000000000000006000701E014010001000000CE8E01000E00BB0200000000000006000701E514010014000000CF8E01000E006B0700000000000006000701FB14010014000000D08E01000E00DB0500000000000006000702E514010032000000D18E01000E009F0F00000000000006000702FB14010032000000D28E01000E00630000000000000006000702E91401000A000000EC8E01000E003100000000000000050307012213010001000000ED8E01000E000900000000000000050107011F13010001000000EE8E01000E00AF04000000000000060007024C1301001E000000EF8E01000E00B70B00000000000005000703E514010064000000F08E01000E002700000000000000060007019615010001000000F18E01000E00860100000000000006000701961501000B000000
		writeQ(_adena); // Player Adena Count
		writeQ(_goldCoins);
		writeQ(_silverCoins);
		writeC(0x01); // UNK
		writeD(_products.size());
		for (ProductItem product : _products)
		{
			writeD(product.getId()); // product id
			writeC(product.getCategory()); // 11 - припасы, 12 - снаряжение, 13 - VIP, 14 - ивент, 15 - наградные монеты
			writeC(product.getCategory() == 15 ? 3 : 0); // UNK, 0x03 - при типе = 15, при остальных = 0x00
			writeD(product.getCategory() == 15 ? product.getGoldCoinCount() : product.getPrice()); // Price in NC or
																									// Lucky Coins
			writeD(product.getCategory() == 15 ? product.getSilverCoinCount() : 0); // Price in VIP Coins
			writeC(product.isNew() ? 6 : (product.isHot() ? 5 : 0)); // 5 - hot, 6 - new
			writeC(product.getMinVipLevel()); // Min VIP level
			writeC(product.getMaxVipLevel()); // Max VIP level

			writeC(product.getComponents().size()); // Количество итемов в продукте.
			for (ProductItemComponent component : product.getComponents())
			{
				writeD(component.getId()); // item id
				writeD((int) component.getCount()); // quality
			}
		}
	}
}